<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Manajemen Barang</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }

    .container {
      display: flex;
      flex-direction: column;
    }

    .section {
      margin-bottom: 20px;
    }

    .flex-container {
      display: flex;
    }

    .flex-item {
      flex: 1;
      margin-right: 20px;
    }

    input[type="text"] {
      width: calc(100% - 10px);
      padding: 8px;
      margin-bottom: 10px;
    }

    input[type="submit"] {
      background-color: #007bff;
      color: #fff;
      border: none;
      padding: 10px 20px;
      cursor: pointer;
    }

    input[type="submit"]:hover {
      background-color: #0056b3;
    }

    ul {
      list-style-type: none;
      padding: 0;
    }

    li {
      border-bottom: 1px solid #ccc;
      padding: 10px 0;
    }

    li:last-child {
      border-bottom: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="flex-container">
      <!-- Bagian untuk Mengedit Barang -->
      <div class="flex-item" id="editSection">
        <h2>Edit Barang</h2>
        <form id="editItemForm">
          <input type="text" id="editNama" name="nama" placeholder="Nama" required><br>
          <input type="text" id="editDescription" name="description" placeholder="Description" required><br>
          <input type="text" id="editQuantity" name="quantity" placeholder="Quantity" required><br>
          <input type="text" id="editPrice" name="price" placeholder="Price" required><br>
          <input type="text" id="editExpirationDate" name="expiration_date" placeholder="Expiration Date" required><br><br>
          <input type="submit" value="Edit Barang">
        </form>
      </div>
      <!-- Bagian untuk Menambah Barang Baru -->
      <div class="flex-item" id="addSection">
        <h2>Tambah Barang Baru</h2>
        <form id="addItemForm">
          <input type="text" id="addNama" name="nama" placeholder="Nama" required><br>
          <input type="text" id="addDescription" name="description" placeholder="Description" required><br>
          <input type="text" id="addQuantity" name="quantity" placeholder="Quantity" required><br>
          <input type="text" id="addPrice" name="price" placeholder="Price" required><br>
          <input type="text" id="addExpirationDate" name="expiration_date" placeholder="Expiration Date" required><br><br>
          <input type="submit" value="Tambah Barang">
        </form>
      </div>
    </div>

    <!-- Bagian untuk Menampilkan List Barang -->
    <div class="section" id="listSection">
      <h2>List Barang</h2>
      <ul id="itemList">
        <!-- Data barang akan ditampilkan di sini -->
      </ul>
    </div>
  </div>

  <script>
    let editingItemId = null;

    // Fungsi untuk menampilkan data barang
    function renderItems() {
      const itemList = document.getElementById('itemList');
      itemList.innerHTML = '';
      fetch('https://crud-toko-sembako-dot-tokosembako.et.r.appspot.com/api/sembako/')
        .then(response => response.json())
        .then(data => {
          data.forEach(item => {
            const li = document.createElement('li');
            li.innerHTML = `Nama: ${item.nama} | Description: ${item.description} | Quantity: ${item.quantity} | Price: $${item.price} | Expiration Date: ${item.expiration_date} | <button onclick="editItem(${item.id})">Edit</button> | <button onclick="deleteItem(${item.id})">Delete</button>`;
            itemList.appendChild(li);
          });
        })
        .catch(error => {
          console.error('There was a problem with the fetch operation:', error);
        });
    }

    // Fungsi untuk menambahkan barang baru
    function addItem(event) {
      event.preventDefault();
      const form = document.getElementById('addItemForm');
      fetch('https://crud-toko-sembako-dot-tokosembako.et.r.appspot.com/api/sembako/', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          nama: form.nama.value,
          description: form.description.value,
          quantity: form.quantity.value,
          price: form.price.value,
          expiration_date: form.expiration_date.value
        })
      })
      .then(response => response.json())
      .then(data => {
        renderItems();
        form.reset();
      })
      .catch(error => {
        console.error('There was a problem with the fetch operation:', error);
      });
    }

    // Fungsi untuk mengedit barang
    function editItem(id) {
      const form = document.getElementById('editItemForm');
      fetch(`https://crud-toko-sembako-dot-tokosembako.et.r.appspot.com/api/sembako/${id}`)
        .then(response => response.json())
        .then(data => {
          editingItemId = id;
          form.nama.value = data.nama;
          form.description.value = data.description;
          form.quantity.value = data.quantity;
          form.price.value = data.price;
          form.expiration_date.value = data.expiration_date;
          document.getElementById('editSection').style.display = 'block';
        })
        .catch(error => {
          console.error('There was a problem with the fetch operation:', error);
        });
    }

    // Fungsi untuk menyimpan perubahan pada barang yang diedit
    function saveEdit(event) {
      event.preventDefault();
      const form = document.getElementById('editItemForm');
      fetch(`https://crud-toko-sembako-dot-tokosembako.et.r.appspot.com/api/sembako/${editingItemId}`, {
        method: 'PUT',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          nama: form.nama.value,
          description: form.description.value,
          quantity: form.quantity.value,
          price: form.price.value,
          expiration_date: form.expiration_date.value
        })
      })
      .then(response => {
        if (response.ok) {
          renderItems();
          form.reset();
          document.getElementById('editSection').style.display = 'none';
        } else {
          throw new Error('Failed to update item');
        }
      })
      .catch(error => {
        console.error('There was a problem with the fetch operation:', error);
      });
    }

    // Fungsi untuk menghapus barang
    function deleteItem(id) {
      fetch(`https://crud-toko-sembako-dot-tokosembako.et.r.appspot.com/api/sembako/${id}`, {
        method: 'DELETE'
      })
      .then(response => {
        if (response.ok) {
          renderItems();
        } else {
          throw new Error('Failed to delete item');
        }
      })
      .catch(error => {
        console.error('There was a problem with the fetch operation:', error);
      });
    }

    // Assign event listeners
    document.getElementById('addItemForm').addEventListener('submit', addItem);
    document.getElementById('editItemForm').addEventListener('submit', saveEdit);

    // Check if the user is logged in
    fetch('https://crud-toko-sembako-dot-tokosembako.et.r.appspot.com/api/user/login', {
      method: 'GET'
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        renderItems();
      } else {
        window.location.href = 'login.html';
      }
    })
    .catch(error => {
      console.error('There was a problem with the fetch operation:', error);
    });
  </script>
</body>
</html>
